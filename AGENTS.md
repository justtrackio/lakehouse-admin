# AGENT GUIDELINES

This document serves as the authoritative guide for AI agents operating within the `lakehouse-admin` repository. Adherence to these guidelines is mandatory to ensure code quality, consistency, and stability.

## 1. Project Overview & Architecture
- **Backend**: Go 1.24+ using `gosoline` framework. Handles API logic, data orchestration, and integrations (Trino, Spark).
- **Frontend**: React (Vite) + TypeScript. Uses Ant Design (`antd`) for UI, `@tanstack/react-query` for data fetching, and `@tanstack/react-router` for routing.
- **Database**: MySQL/MariaDB (inferred from SQL migrations) for metadata storage; Trino for Iceberg table operations.

## 2. Development Environment & Commands

### Backend (`/backend`)
*   **Build**: `cd backend && go build ./...`
*   **Run Tests**:
    *   All tests: `cd backend && go test ./...`
    *   Single test: `cd backend && go test ./... -run TestName` (e.g., `-run TestOptimize`)
    *   Verbose mode (recommended for debugging): `go test -v ./...`
*   **Formatting**: `cd backend && go fmt ./...` (Run this before every commit)
*   **Dependencies**: managed via `go.mod`. Use `go get` to add, `go mod tidy` to clean up.

### Frontend (`/frontend`)
*   **Install Dependencies**: `cd frontend && bun install` (or `npm install`)
*   **Dev Server**: `cd frontend && bun run dev`
*   **Build**: `cd frontend && bun run build` (includes TypeCheck via `tsc -b`)
*   **Lint**: `cd frontend && bun run lint`
*   **Test**: Currently no frontend tests configured.

## 3. Code Style & Conventions

### Backend (Go)
*   **Naming**:
    *   Exported types/funcs: `PascalCase`
    *   Local variables/unexported: `camelCase`
    *   Acronyms: Keep consistent (e.g., `ServeHTTP`, `ID`, `URL` - not `ServeHttp`, `Id`, `Url`).
    *   Interfaces: typically end in `-er` (e.g., `Reader`, `Writer`).
*   **Error Handling**:
    *   **NEVER** ignore errors.
    *   Wrap errors with context: `fmt.Errorf("could not fetch table metadata: %w", err)`.
    *   Return errors early (guard clauses) to reduce nesting.
*   **Imports**:
    *   Group 1: Standard library (`"fmt"`, `"time"`)
    *   Group 2: Third-party & Project imports (`"github.com/..."`)
    *   *Note: `go fmt` handles this automatically, but be aware.*
*   **Types**:
    *   Prefer concrete types over `interface{}`/`any` where possible.
    *   Use the custom `DateTime` type (`backend/datetime.go`) for JSON APIs handling dates to ensure consistent RFC3339/Date-only parsing.

### Frontend (TypeScript/React)
*   **Naming**:
    *   Components: `PascalCase.tsx` (e.g., `OptimizeCard.tsx`).
    *   Hooks: `useHookName.ts`.
    *   Utils/Constants: `camelCase.ts`.
*   **Types**:
    *   **Strict Mode is ON**. No implicit `any`.
    *   Define interfaces for all props and API responses in `src/api/schema.ts`.
    *   Use `type` or `interface` consistently (Project prefers `interface` for object shapes).
*   **React Patterns**:
    *   Functional Components only.
    *   Hooks must be at the top level.
    *   Use `useMutation` for writes and `useQuery` for reads (`@tanstack/react-query`).
*   **UI/UX**:
    *   Use `antd` components (Card, Form, Button, Spin, Alert) to match existing design.
    *   Show loading states (`<Spin />`) and error alerts (`<Alert type="error" />`) for async operations.

## 4. Specific Implementation details

### Routing (TanStack Router)
*   Routes are file-based in `frontend/src/routes`.
*   **Do not edit** `routeTree.gen.ts` manually; it is generated by the framework.

### API Clients
*   **Backend**: Extend `TrinoClient` (`backend/trino_client.go`) or `SparkClient` (`backend/spark_client.go`) for new query capabilities. Do not create ad-hoc clients.
*   **Frontend**: Centralize all HTTP calls in `frontend/src/api/client.ts` and export typed functions in `schema.ts`.

### Logging
*   **Backend**: Use the injected `log.Logger` from `gosoline`.
    *   `logger.Info("message %s", var)`
    *   `logger.Error("context: %w", err)`

## 5. Agent Operational Rules
1.  **Safety**: Always read a file before editing it to ensure you have the latest context.
2.  **Verification**: After **every** backend change, run `cd backend && go build ./...` to verify compilation.
3.  **Verification**: After **every** frontend change, run `cd frontend && bun run build` to verify type safety and build success.
4.  **Incremental Changes**: Do not refactor entire files unless necessary. Make targeted, minimal changes to achieve the goal.
5.  **No "Magic" Fixes**: If a build fails, analyze the error message. Do not blindly attempt to fix it without understanding the root cause.
6.  **Tooling**: Do not introduce new global tools (like `prettier` or separate linters) unless explicitly asked. Use the provided `bun run lint` and `go fmt`.

## 6. External Rules (Cursor/Copilot)
*   *No specific rules found in `.cursor/rules`, `.cursorrules`, or `.github/copilot-instructions.md` at this time.*
